# gpu-operator-values.yaml
# å®Œå…¨è‡ªå‹•æ¤œå‡ºç‰ˆGPU Operatorè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆç›£è¦–çµ±åˆå¯¾å¿œï¼‰

global:
  imagePullPolicy: IfNotPresent

operator:
  defaultRuntime: containerd

# Node Feature Discoveryè¨­å®š
nfd:
  enabled: true
  tolerations:
  - key: dedicated
    operator: Equal
    value: gpu-compute
    effect: NoSchedule
  - key: node-role.kubernetes.io/master
    operator: Equal
    effect: NoSchedule
  - key: node-role.kubernetes.io/control-plane
    operator: Equal
    effect: NoSchedule
    
  worker:
    config:
      core:
        featureSources: ["all"]
        labelSources: ["all"]
      sources:
        pci:
          deviceClassWhitelist:
          - "02"
          - "03"
          - "0300"
          - "0302"

# Driverè¨­å®š
driver:
  enabled: true
  repository: nvcr.io/nvidia
  image: driver
  tolerations:
  - key: dedicated
    operator: Equal
    value: gpu-compute
    effect: NoSchedule

# Container Toolkitè¨­å®š
toolkit:
  enabled: true
  tolerations:
  - key: dedicated
    operator: Equal
    value: gpu-compute
    effect: NoSchedule

# Device Pluginè¨­å®š
devicePlugin:
  enabled: true
  tolerations:
  - key: dedicated
    operator: Equal
    value: gpu-compute
    effect: NoSchedule

# GPU Feature Discoveryè¨­å®š
gfd:
  enabled: true
  tolerations:
  - key: dedicated
    operator: Equal
    value: gpu-compute
    effect: NoSchedule

# ğŸ”§ é‡è¦ä¿®æ­£: DCGM Exporterè¨­å®šï¼ˆç›£è¦–çµ±åˆå¯¾å¿œï¼‰
dcgmExporter:
  enabled: true
  # ğŸ”§ è¿½åŠ : Serviceè¨­å®šï¼ˆPrometheusçµ±åˆç”¨ï¼‰
  service:
    enable: true
    type: ClusterIP
    port: 9400
    targetPort: 9400
    labels:
      app: nvidia-dcgm-exporter  # ğŸ”§ é‡è¦: ServiceMonitorã¨ä¸€è‡´ã•ã›ã‚‹
  tolerations:
  - key: dedicated
    operator: Equal
    value: gpu-compute
    effect: NoSchedule
  # ğŸ”§ è¿½åŠ : ServiceMonitorè‡ªå‹•ä½œæˆè¨­å®š
  serviceMonitor:
    enabled: false  # æ‰‹å‹•ã§ä½œæˆã™ã‚‹ãŸã‚false
    interval: 15s
    additionalLabels:
      release: prometheus-cluster  # ğŸ”§ Prometheusã¨ã®é€£æºç”¨

# MIG Managerè¨­å®š
migManager:
  enabled: false

# Validatorè¨­å®š
validator:
  plugin:
    enabled: true
  tolerations:
  - key: dedicated
    operator: Equal
    value: gpu-compute
    effect: NoSchedule
